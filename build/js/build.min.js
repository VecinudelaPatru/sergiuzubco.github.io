var Core=function(e){var t={},n={};return{register:function(e,n){"string"==typeof e&&"function"==typeof n&&(t[e]={create:n,instance:null})},start:function(e){var n=t[e];n&&(n.instance=n.create(Sandbox.create(this,e)),n.instance.construct())},stop:function(e){var n=t[e];n&&n.instance&&(n.instance.destruct(),n.instance=null)},startAll:function(){for(var e in t)t.hasOwnProperty(e)&&this.start(e)},showModule:function(e){var n=t[e];n&&n.instance.show()},hideModule:function(e){var n=t[e];n&&n.instance.hide()},stopAll:function(){for(var e in t)t.hasOwnProperty(e)&&this.stop(e)},publish:function(e,t){try{for(var i=0;i<n[e].length;i++)"undefined"==typeof t&&(t=[]),t instanceof Array||(t=[t]),n[e][i].apply(this,t)}catch(r){}},subscribe:function(e,t){return n[e]||(n[e]=[]),n[e].push(t),[e,t]},unsubscribe:function(e){var t=e[0];base.each(n[t],function(i){e[1]==this&&n[t].splice(i,1)})},dom:{query:function(t,n){var i,r={},c=this;return i=n&&n.find?n.find(t):e(t),r=i.get(),r.length=i.length,r.query=function(e){return c.query(e,i)},r},on:function(t,n,i){t&&n&&("function"==typeof n&&(i=n,n="click"),e(t).on(n,i))},off:function(t,n,i){t&&n&&("function"==typeof n&&(i=n,n="click"),e(t).off(n,i))},createElement:function(e){return document.createElement(e)},attrs:function(t,n){e(t).attr(n)},addClass:function(t,n){e(t).addClass(n)},removeClass:function(t,n){e(t).removeClass(n)},setText:function(t,n){e(t).html(n)}}}}(jQuery),Router={settings:{}};Router.observer=function(){var e={},t={},n=0;return e.on=function(i,r){return"function"==typeof r&&(r.id="undefined"==typeof r.id?n++:r.id,i.replace(/\S+/g,function(e,n){(t[e]=t[e]||[]).push(r),r.typed=n>0})),e},e.off=function(n,i){return"*"==n?t={}:n.replace(/\S+/g,function(e){if(i)for(var n,r=t[e],c=0;n=r&&r[c];++c)n.id==i.id&&(r.splice(c,1),c--);else t[e]=[]}),e},e.trigger=function(n){for(var i,r=[].slice.call(arguments,1),c=t[n]||[],s=0;i=c[s];++s)i.busy||(i.busy=1,i.apply(e,i.typed?[n].concat(r):r),c[s]!==i&&s--,i.busy=0);return t.all&&"all"!=n&&e.trigger.apply(e,["all",n].concat(r)),e},e},function(e,t,n){function i(){return u.href.split("#")[1]||""}function r(e){return e.split("/")}function c(e){e.type&&(e=i()),e!=s&&(o.trigger.apply(null,["H"].concat(r(e))),s=e)}if(n){var s,u=n.location,o=e.observer(),a=n,l=!1,d=e.route=function(e){e[0]?(u.hash=e,c(e)):o.on("H",e)};d.study=function(e){e.apply(null,r(i()))},d.start=function(){l||(a.addEventListener?a.addEventListener(t,c,!1):a.attachEvent("on"+t,c),l=!0)},d.stop=function(){l&&(a.removeEventListener?a.removeEventListener(t,c,!1):a.detachEvent("on"+t,c),o.off("*"),l=!1)}}}(Router,"hashchange",window);var Sandbox={create:function(e,t){var n=e.dom.query("#"+t);return{query:function(t){return e.dom.query(t)},find:function(e){return n.query(e)},addEvent:function(t,n,i){e.dom.on(t,n,i)},removeEvent:function(t,n,i){e.dom.off(t,n,i)},publish:function(t,n){e.publish(t,n)},subscribe:function(t,n){e.subscribe(t,n)},unsubscribe:function(t){e.unsubscribe(t)},createElement:function(t,n){var i,r;if(t=e.dom.createElement(t),n){if(n.children){for(i=0;r=n.children[i];)t.appendChild(r),i++;delete n.children}n.text&&(t.appendChild(document.createTextNode(n.text)),delete n.text),e.dom.attrs(t,n)}return t},attrs:function(t,n){e.dom.attrs(t,n)},addClass:function(t,n){e.dom.addClass(t,n)},removeClass:function(t,n){e.dom.removeClass(t,n)},setText:function(t,n){e.dom.setText(t,n)}}}};Core.register("chat",function(e){var t,n,i,r,c={createBubble:function(t){return e.createElement("p",{children:[e.createElement("h6",{text:t.user})],"class":t.className,text:t.message})}};return{construct:function(){t=e.query("#chat")[0],i=e.find(".chat-messages")[0],r="Me",e.subscribe("new-message",this.addNewMessage),e.subscribe("new-name",this.changeName)},destruct:function(){t=n=i=null},show:function(){e.addClass(t,"active"),e.publish("module-shown","chat")},hide:function(){e.removeClass(t,"active"),e.publish("module-hidden","chat")},addNewMessage:function(e){var t={};t.className="bubble pull-right",t.user=r,t.message=e,i.appendChild(c.createBubble(t)),n.emit("message",{user:r,message:e})},connect:function(){n.on("message",function(e){e.className="bubble pull-left",i.appendChild(c.createBubble(e))})},changeName:function(e){r=e}}}),Core.register("chat-form",function(e){var t,n,i,r={getInputValue:function(){return t.value},setInputValue:function(e){t.value=e}};return{construct:function(){i=e.query("#chat-form"),t=e.find("input")[0],n=e.find("button")[0],e.addEvent(n,"click",this.sendMessage)},destruct:function(){t=n=i=null,e.removeEvent(n,"click",this.sendMessage)},show:function(){e.removeClass(i,"hidden")},hide:function(){e.addClass(i,"hidden")},sendMessage:function(){var t=r.getInputValue();t&&(e.publish("new-message",t),r.setInputValue(""))}}}),Core.register("gallery",function(e){var t,n,i,r,c,s,u,o,a={createSlide:function(){return e.createElement("img",{src:i})}};return{construct:function(){t=e.query("#gallery")[0],n=e.find(".gallery")[0],r="100%",c="480px",s=e.find(".fa-chevron-right")[0],u=e.find(".fa-chevron-left")[0],i="http://lorempixel.com/1024/768/city/",o=[],e.addEvent(s,"click",this.next),e.addEvent(u,"click",this.prev),e.subscribe("new-width",this.changeWidth),e.subscribe("new-height",this.changeHeight)},destruct:function(){t=n=r=c=s=u=i=null,o=[],e.removeEvent(s,"click",this.next),e.removeEvent(u,"click",this.prev)},show:function(){e.addClass(t,"active"),e.publish("module-shown","gallery")},hide:function(){e.removeClass(t,"active"),e.publish("module-hidden","gallery")},changeWidth:function(t){r=t+"%",e.attrs(n,{style:"width: "+r+"; height: "+c})},changeHeight:function(t){c=t+"px",e.attrs(n,{style:"width: "+r+"; height: "+c})},addNewSlide:function(){n.appendChild(a.createSlide())},next:function(){n.appendChild(a.createSlide())},prev:function(){}}}),Core.register("segmented-control",function(e){var t,n={chat:0,gallery:1,settings:2};return{construct:function(){t=e.find("a"),e.subscribe("module-shown",this.activateControl),e.subscribe("module-hidden",this.deactivateControl)},destruct:function(){t=null},activateControl:function(i){e.addClass(t[n[i]],"active")},deactivateControl:function(i){e.removeClass(t[n[i]],"active")}}}),Core.register("settings",function(e){var t,n,i,r,c,s,u;return{construct:function(){t=e.query("#settings"),n=e.find("#wslider")[0],i=e.find("#hslider")[0],s=e.find("#wslidertext")[0],u=e.find("#hslidertext")[0],r=e.find("#chatname")[0],c=e.find("#chatnamebtn")[0],e.addEvent(n,"change",this.changeWidth),e.addEvent(i,"change",this.changeHeight),e.addEvent(c,"click",this.setChatName)},destruct:function(){t=n=i=s=u=null,e.removeEvent(n,"click",this.changeWidth),e.removeEvent(i,"click",this.changeHeight)},show:function(){e.addClass(t,"active"),e.publish("module-shown","settings")},hide:function(){e.removeClass(t,"active"),e.publish("module-hidden","settings")},changeWidth:function(t){var n=t.currentTarget.value;e.setText(s,"&nbsp;"+n+"%"),e.publish("new-width",n)},changeHeight:function(t){var n=t.currentTarget.value;e.setText(u,"&nbsp;"+n+"px"),e.publish("new-height",n)},setChatName:function(){var t=r.value;t&&(e.publish("new-name",t),r.value="")}}}),function(e,t,n){var i=t.dom.query("#backdrop","body")[0],r=null;t.dom.removeClass(i,"hidden"),t.startAll(),n.route.start();var c=function(e){t.hideModule("chat"),t.hideModule("chat-form"),t.hideModule("gallery"),t.hideModule("settings"),("chat"==e||""==e)&&(t.showModule("chat-form"),e="chat"),t.showModule(e),r=e};n.route.study(function(e){c(e)}),n.route(function(e,t,n){r!=e&&c(e)}),t.dom.addClass(i,"hidden")}(jQuery,Core,Router);