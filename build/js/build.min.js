var Core=function(e){var t={},n={};return{register:function(e,n){"string"==typeof e&&"function"==typeof n&&(t[e]={create:n,instance:null})},start:function(e){var n=t[e];n&&(n.instance=n.create(Sandbox.create(this,e)),n.instance.construct())},stop:function(e){var n=t[e];n&&n.instance&&(n.instance.destruct(),n.instance=null)},startAll:function(){for(var e in t)t.hasOwnProperty(e)&&this.start(e)},showModule:function(e){var n=t[e];n&&n.instance.show()},hideModule:function(e){var n=t[e];n&&n.instance.hide()},stopAll:function(){for(var e in t)t.hasOwnProperty(e)&&this.stop(e)},publish:function(e,t){try{for(var i=0;i<n[e].length;i++)"undefined"==typeof t&&(t=[]),t instanceof Array||(t=[t]),n[e][i].apply(this,t)}catch(r){}},subscribe:function(e,t){return n[e]||(n[e]=[]),n[e].push(t),[e,t]},unsubscribe:function(e){var t=e[0];base.each(n[t],function(i){e[1]==this&&n[t].splice(i,1)})},dom:{query:function(t,n){var i,r={},s=this;return i=n&&n.find?n.find(t):e(t),r=i.get(),r.length=i.length,r.query=function(e){return s.query(e,i)},r},on:function(t,n,i){t&&n&&("function"==typeof n&&(i=n,n="click"),e(t).on(n,i))},off:function(t,n,i){t&&n&&("function"==typeof n&&(i=n,n="click"),e(t).off(n,i))},createElement:function(e){return document.createElement(e)},attrs:function(t,n){e(t).attr(n)},addClass:function(t,n){e(t).addClass(n)},removeClass:function(t,n){e(t).removeClass(n)},setText:function(t,n){e(t).html(n)}}}}(jQuery),Router={settings:{}};Router.observer=function(){var e={},t={},n=0;return e.on=function(i,r){return"function"==typeof r&&(r.id="undefined"==typeof r.id?n++:r.id,i.replace(/\S+/g,function(e,n){(t[e]=t[e]||[]).push(r),r.typed=n>0})),e},e.off=function(n,i){return"*"==n?t={}:n.replace(/\S+/g,function(e){if(i)for(var n,r=t[e],s=0;n=r&&r[s];++s)n.id==i.id&&(r.splice(s,1),s--);else t[e]=[]}),e},e.trigger=function(n){for(var i,r=[].slice.call(arguments,1),s=t[n]||[],c=0;i=s[c];++c)i.busy||(i.busy=1,i.apply(e,i.typed?[n].concat(r):r),s[c]!==i&&c--,i.busy=0);return t.all&&"all"!=n&&e.trigger.apply(e,["all",n].concat(r)),e},e},function(e,t,n){function i(){return u.href.split("#")[1]||""}function r(e){return e.split("/")}function s(e){e.type&&(e=i()),e!=c&&(a.trigger.apply(null,["H"].concat(r(e))),c=e)}if(n){var c,u=n.location,a=e.observer(),o=n,d=!1,l=e.route=function(e){e[0]?(u.hash=e,s(e)):a.on("H",e)};l.study=function(e){e.apply(null,r(i()))},l.start=function(){d||(o.addEventListener?o.addEventListener(t,s,!1):o.attachEvent("on"+t,s),d=!0)},l.stop=function(){d&&(o.removeEventListener?o.removeEventListener(t,s,!1):o.detachEvent("on"+t,s),a.off("*"),d=!1)}}}(Router,"hashchange",window);var Sandbox={create:function(e,t){var n=e.dom.query("#"+t);return{query:function(t){return e.dom.query(t)},find:function(e){return n.query(e)},addEvent:function(t,n,i){e.dom.on(t,n,i)},removeEvent:function(t,n,i){e.dom.off(t,n,i)},publish:function(t,n){e.publish(t,n)},subscribe:function(t,n){e.subscribe(t,n)},unsubscribe:function(t){e.unsubscribe(t)},createElement:function(t,n){var i,r;if(t=e.dom.createElement(t),n){if(n.children){for(i=0;r=n.children[i];)t.appendChild(r),i++;delete n.children}n.text&&(t.appendChild(document.createTextNode(n.text)),delete n.text),e.dom.attrs(t,n)}return t},attrs:function(t,n){e.dom.attrs(t,n)},addClass:function(t,n){e.dom.addClass(t,n)},removeClass:function(t,n){e.dom.removeClass(t,n)},setText:function(t,n){e.dom.setText(t,n)}}}};Core.register("chat",function(e){var t,n,i,r,s={createBubble:function(t){return e.createElement("p",{children:[e.createElement("h6",{text:t.user})],"class":t.className,text:t.message})}};return{construct:function(){t=e.query("#chat")[0],i=e.find(".chat-messages")[0],r="Me",e.subscribe("new-message",this.addNewMessage),e.subscribe("new-name",this.changeName)},destruct:function(){t=n=i=null},show:function(){e.addClass(t,"active"),e.publish("module-shown","chat")},hide:function(){e.removeClass(t,"active"),e.publish("module-hidden","chat")},addNewMessage:function(e){var t={};t.className="bubble pull-right",t.user=r,t.message=e,i.appendChild(s.createBubble(t)),n.emit("message",{user:r,message:e})},connect:function(){n.on("message",function(e){e.className="bubble pull-left",i.appendChild(s.createBubble(e))})},changeName:function(e){r=e}}}),Core.register("chat-form",function(e){var t,n,i,r={getInputValue:function(){return t.value},setInputValue:function(e){t.value=e}};return{construct:function(){i=e.query("#chat-form"),t=e.find("input")[0],n=e.find("button")[0],e.addEvent(n,"click",this.sendMessage)},destruct:function(){t=n=i=null,e.removeEvent(n,"click",this.sendMessage)},show:function(){e.removeClass(i,"hidden")},hide:function(){e.addClass(i,"hidden")},sendMessage:function(){var t=r.getInputValue();t&&(e.publish("new-message",t),r.setInputValue(""))}}}),Core.register("gallery",function(e){var t,n,i,r,s,c,u,a,o,d={createSlide:function(){return e.createElement("img",{src:i+(new Date).getTime()})},getSlidesLength:function(){return a.length},emptySlider:function(){e.setText(n,"")}};return{construct:function(){t=e.query("#gallery")[0],n=e.find(".gallery")[0],r="100%",s="480px",c=e.find(".fa-chevron-right")[0],u=e.find(".fa-chevron-left")[0],i="http://lorempixel.com/1024/768/?",a=[],o=0,e.addEvent(c,"click",this.nextFn),e.addEvent(u,"click",this.prevFn),e.subscribe("new-width",this.changeWidth),e.subscribe("new-height",this.changeHeight),this.addNewSlide()},destruct:function(){t=n=r=s=c=u=i=o=null,a=[],e.removeEvent(c,"click",this.nextFn),e.removeEvent(u,"click",this.prevFn)},show:function(){e.addClass(t,"active"),e.publish("module-shown","gallery")},hide:function(){e.removeClass(t,"active"),e.publish("module-hidden","gallery")},changeWidth:function(t){r=t+"%",e.attrs(n,{style:"width: "+r+"; height: "+s})},changeHeight:function(t){s=t+"px",e.attrs(n,{style:"width: "+r+"; height: "+s})},addNewSlide:function(){var e=d.createSlide();n.appendChild(e),a.push(e)},nextFn:function(){var e;d.emptySlider(),o==d.getSlidesLength()-1?(e=d.createSlide(),n.appendChild(e),a.push(e),o=d.getSlidesLength()-1):(o+=1,n.appendChild(a[o]))},prevFn:function(){0!=o&&(d.emptySlider(),o-=1,n.appendChild(a[o]))}}}),Core.register("segmented-control",function(e){var t,n={chat:0,gallery:1,settings:2};return{construct:function(){t=e.find("a"),e.subscribe("module-shown",this.activateControl),e.subscribe("module-hidden",this.deactivateControl)},destruct:function(){t=null},activateControl:function(i){e.addClass(t[n[i]],"active")},deactivateControl:function(i){e.removeClass(t[n[i]],"active")}}}),Core.register("settings",function(e){var t,n,i,r,s,c,u;return{construct:function(){t=e.query("#settings"),n=e.find("#wslider")[0],i=e.find("#hslider")[0],c=e.find("#wslidertext")[0],u=e.find("#hslidertext")[0],r=e.find("#chatname")[0],s=e.find("#chatnamebtn")[0],e.addEvent(n,"change",this.changeWidth),e.addEvent(i,"change",this.changeHeight),e.addEvent(s,"click",this.setChatName)},destruct:function(){t=n=i=c=u=null,e.removeEvent(n,"click",this.changeWidth),e.removeEvent(i,"click",this.changeHeight)},show:function(){e.addClass(t,"active"),e.publish("module-shown","settings")},hide:function(){e.removeClass(t,"active"),e.publish("module-hidden","settings")},changeWidth:function(t){var n=t.currentTarget.value;e.setText(c,"&nbsp;"+n+"%"),e.publish("new-width",n)},changeHeight:function(t){var n=t.currentTarget.value;e.setText(u,"&nbsp;"+n+"px"),e.publish("new-height",n)},setChatName:function(){var t=r.value;t&&(e.publish("new-name",t),r.value="")}}}),function(e,t,n){var i=t.dom.query("#backdrop","body")[0],r=null;t.dom.removeClass(i,"hidden"),t.startAll(),n.route.start();var s=function(e){t.hideModule("chat"),t.hideModule("chat-form"),t.hideModule("gallery"),t.hideModule("settings"),("chat"==e||""==e)&&(t.showModule("chat-form"),e="chat"),t.showModule(e),r=e};n.route.study(function(e){s(e)}),n.route(function(e,t,n){r!=e&&s(e)}),t.dom.addClass(i,"hidden")}(jQuery,Core,Router);